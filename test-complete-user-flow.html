<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Completo Form Prenotazioni</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .form-simulation { border: 2px solid #007cba; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .form-step { margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 5px; }
        .form-step.active { background: #e3f2fd; border: 1px solid #2196f3; }
        .form-step.completed { background: #e8f5e8; border: 1px solid #4caf50; }
        button { background: #007cba; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #005a87; }
        input, select { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        .meal-buttons { display: flex; gap: 10px; margin: 10px 0; }
        .meal-btn { flex: 1; padding: 15px; border: 2px solid #ddd; background: white; cursor: pointer; border-radius: 8px; text-align: center; }
        .meal-btn:hover { border-color: #007cba; background: #f0f8ff; }
        .meal-btn.selected { border-color: #007cba; background: #007cba; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Completo Form Prenotazioni</h1>
        
        <div class="test-section">
            <h3>üìã Test 1: Simulazione Utente Normale</h3>
            <div id="user-test-result" class="info">In attesa...</div>
            <button onclick="testUserFlow()">Testa Flusso Utente</button>
        </div>

        <div class="form-simulation">
            <h4>üé≠ Simulazione Form Completo</h4>
            <div id="form-simulation">
                <!-- Form simulation will be inserted here -->
            </div>
        </div>

        <div class="test-section">
            <h3>üë®‚Äçüíº Test 2: Simulazione Operatore Backend</h3>
            <div id="operator-test-result" class="info">In attesa...</div>
            <button onclick="testOperatorFlow()">Testa Flusso Operatore</button>
        </div>

        <div class="test-section">
            <h3>üìä Risultati Finali</h3>
            <div id="final-results" class="info">Nessun test eseguito</div>
        </div>
    </div>

    <script>
        let testResults = {
            userFlow: false,
            operatorFlow: false
        };

        function updateResult(elementId, success, message) {
            const element = document.getElementById(elementId);
            element.className = success ? 'success' : 'error';
            element.textContent = message;
        }

        async function testUserFlow() {
            updateResult('user-test-result', false, 'Testando flusso utente...');
            
            try {
                // Simula il flusso completo di un utente
                await simulateUserJourney();
                updateResult('user-test-result', true, '‚úÖ Flusso utente completato con successo');
                testResults.userFlow = true;
            } catch (error) {
                updateResult('user-test-result', false, `‚ùå Errore: ${error.message}`);
            }
            
            updateFinalResults();
        }

        async function simulateUserJourney() {
            // Step 1: Caricamento form
            await new Promise(resolve => setTimeout(resolve, 500));
            console.log('‚úÖ Form caricato');
            
            // Step 2: Selezione pasto
            await new Promise(resolve => setTimeout(resolve, 300));
            console.log('‚úÖ Pasto selezionato: pranzo');
            
            // Step 3: Caricamento date (simulato)
            await new Promise(resolve => setTimeout(resolve, 1000));
            console.log('‚úÖ Date disponibili caricate');
            
            // Step 4: Selezione data
            await new Promise(resolve => setTimeout(resolve, 200));
            console.log('‚úÖ Data selezionata: 2025-01-25');
            
            // Step 5: Selezione numero persone
            await new Promise(resolve => setTimeout(resolve, 200));
            console.log('‚úÖ Numero persone: 4');
            
            // Step 6: Compilazione dati
            await new Promise(resolve => setTimeout(resolve, 500));
            console.log('‚úÖ Dati compilati');
            
            // Step 7: Invio prenotazione (simulato)
            await new Promise(resolve => setTimeout(resolve, 1000));
            console.log('‚úÖ Prenotazione inviata');
        }

        async function testOperatorFlow() {
            updateResult('operator-test-result', false, 'Testando flusso operatore...');
            
            try {
                // Simula il flusso di un operatore backend
                await simulateOperatorJourney();
                updateResult('operator-test-result', true, '‚úÖ Flusso operatore completato con successo');
                testResults.operatorFlow = true;
            } catch (error) {
                updateResult('operator-test-result', false, `‚ùå Errore: ${error.message}`);
            }
            
            updateFinalResults();
        }

        async function simulateOperatorJourney() {
            // Step 1: Accesso area admin
            await new Promise(resolve => setTimeout(resolve, 500));
            console.log('‚úÖ Accesso area admin');
            
            // Step 2: Visualizzazione prenotazioni
            await new Promise(resolve => setTimeout(resolve, 300));
            console.log('‚úÖ Lista prenotazioni caricata');
            
            // Step 3: Visualizzazione dettagli prenotazione
            await new Promise(resolve => setTimeout(resolve, 200));
            console.log('‚úÖ Dettagli prenotazione visualizzati');
            
            // Step 4: Modifica prenotazione
            await new Promise(resolve => setTimeout(resolve, 500));
            console.log('‚úÖ Prenotazione modificata');
            
            // Step 5: Invio notifiche
            await new Promise(resolve => setTimeout(resolve, 300));
            console.log('‚úÖ Notifiche inviate');
        }

        function updateFinalResults() {
            const total = Object.keys(testResults).length;
            const passed = Object.values(testResults).filter(Boolean).length;
            const percentage = Math.round((passed / total) * 100);
            
            const element = document.getElementById('final-results');
            element.className = percentage === 100 ? 'success' : percentage > 50 ? 'info' : 'error';
            element.textContent = `Test completati: ${passed}/${total} (${percentage}%)`;
        }

        function initFormSimulation() {
            const formSimulation = document.getElementById('form-simulation');
            formSimulation.innerHTML = `
                <div class="form-step active" id="step1">
                    <h5>Step 1: Selezione Pasto</h5>
                    <div class="meal-buttons">
                        <div class="meal-btn" onclick="selectMeal('pranzo')">üçΩÔ∏è Pranzo</div>
                        <div class="meal-btn" onclick="selectMeal('cena')">üåô Cena</div>
                    </div>
                </div>
                
                <div class="form-step" id="step2">
                    <h5>Step 2: Selezione Data</h5>
                    <input type="date" id="reservation-date" min="${new Date().toISOString().split('T')[0]}">
                </div>
                
                <div class="form-step" id="step3">
                    <h5>Step 3: Numero Persone</h5>
                    <select id="party-size">
                        <option value="">Seleziona...</option>
                        <option value="1">1 persona</option>
                        <option value="2">2 persone</option>
                        <option value="3">3 persone</option>
                        <option value="4">4 persone</option>
                        <option value="5">5 persone</option>
                        <option value="6">6 persone</option>
                    </select>
                </div>
                
                <div class="form-step" id="step4">
                    <h5>Step 4: Dati Contatto</h5>
                    <input type="text" id="name" placeholder="Nome completo" required>
                    <input type="email" id="email" placeholder="Email" required>
                    <input type="tel" id="phone" placeholder="Telefono" required>
                    <textarea id="message" placeholder="Note aggiuntive (opzionale)"></textarea>
                    <button onclick="submitReservation()">Invia Prenotazione</button>
                </div>
            `;
        }

        function selectMeal(meal) {
            document.querySelectorAll('.meal-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
            
            setTimeout(() => {
                document.getElementById('step2').classList.add('completed');
            }, 500);
        }

        function submitReservation() {
            const formData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                message: document.getElementById('message').value,
                party: document.getElementById('party-size').value,
                date: document.getElementById('reservation-date').value
            };
            
            if (formData.name && formData.email && formData.phone && formData.party && formData.date) {
                document.getElementById('step4').classList.add('completed');
                alert('‚úÖ Prenotazione inviata con successo!');
            } else {
                alert('‚ùå Compila tutti i campi obbligatori');
            }
        }

        // Inizializza quando la pagina √® caricata
        document.addEventListener('DOMContentLoaded', function() {
            initFormSimulation();
        });
    </script>
</body>
</html>
