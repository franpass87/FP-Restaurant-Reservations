<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Area Operatore Backend</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .warning { background: #fff3cd; color: #856404; }
        .admin-panel { border: 2px solid #dc3545; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .reservation-item { margin: 10px 0; padding: 15px; background: #f8f9fa; border-radius: 4px; border-left: 4px solid #007cba; }
        .reservation-item.modified { border-left-color: #ffc107; }
        .reservation-item.cancelled { border-left-color: #dc3545; }
        .reservation-item.completed { border-left-color: #28a745; }
        .action-buttons { margin-top: 10px; }
        .action-buttons button { margin-right: 5px; }
        button { background: #007cba; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; }
        button:hover { background: #005a87; }
        button.danger { background: #dc3545; }
        button.danger:hover { background: #c82333; }
        button.warning { background: #ffc107; color: #212529; }
        button.warning:hover { background: #e0a800; }
        button.success { background: #28a745; }
        button.success:hover { background: #218838; }
        .stats { display: flex; gap: 20px; margin: 20px 0; }
        .stat-item { flex: 1; padding: 15px; background: #f8f9fa; border-radius: 4px; text-align: center; }
        .stat-number { font-size: 24px; font-weight: bold; color: #007cba; }
        .stat-label { font-size: 14px; color: #666; }
        .log { background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üë®‚Äçüíº Test Area Operatore Backend</h1>
        
        <div class="test-section">
            <h3>üìä Dashboard Operatore</h3>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="total-reservations">0</div>
                    <div class="stat-label">Prenotazioni Totali</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="today-reservations">0</div>
                    <div class="stat-label">Oggi</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="pending-reservations">0</div>
                    <div class="stat-label">In Attesa</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="confirmed-reservations">0</div>
                    <div class="stat-label">Confermate</div>
                </div>
            </div>
            <button onclick="loadDashboard()">Carica Dashboard</button>
        </div>

        <div class="admin-panel">
            <h4>üìã Gestione Prenotazioni</h4>
            <div id="reservations-list">
                <!-- Reservations will be inserted here -->
            </div>
            <button onclick="loadReservations()">Carica Prenotazioni</button>
            <button onclick="addTestReservation()">Aggiungi Prenotazione Test</button>
        </div>

        <div class="test-section">
            <h3>üîß Test Funzionalit√† Operatore</h3>
            <div id="operator-test-result" class="info">In attesa...</div>
            <button onclick="testOperatorFunctions()">Testa Funzionalit√†</button>
        </div>

        <div class="test-section">
            <h3>üìù Test Modifica Prenotazioni</h3>
            <div id="modification-test-result" class="info">In attesa...</div>
            <button onclick="testReservationModification()">Testa Modifica</button>
        </div>

        <div class="test-section">
            <h3>‚ùå Test Annullamento Prenotazioni</h3>
            <div id="cancellation-test-result" class="info">In attesa...</div>
            <button onclick="testReservationCancellation()">Testa Annullamento</button>
        </div>

        <div class="test-section">
            <h3>üìä Log Operatore</h3>
            <div id="operator-log" class="log">Sistema operatore inizializzato...\n</div>
            <button onclick="clearOperatorLog()">Pulisci Log</button>
        </div>

        <div class="test-section">
            <h3>üéØ Risultati Finali</h3>
            <div id="final-results" class="info">Nessun test eseguito</div>
        </div>
    </div>

    <script>
        let testResults = {
            operatorFunctions: false,
            reservationModification: false,
            reservationCancellation: false
        };

        let reservationCount = 0;
        let reservations = [];

        function updateResult(elementId, success, message) {
            const element = document.getElementById(elementId);
            element.className = success ? 'success' : 'error';
            element.textContent = message;
        }

        function addOperatorLog(message) {
            const log = document.getElementById('operator-log');
            const timestamp = new Date().toLocaleTimeString();
            log.textContent += `[${timestamp}] ${message}\n`;
            log.scrollTop = log.scrollHeight;
        }

        function clearOperatorLog() {
            document.getElementById('operator-log').textContent = 'Log pulito...\n';
        }

        function loadDashboard() {
            addOperatorLog('Caricamento dashboard...');
            
            // Simula caricamento dati
            setTimeout(() => {
                document.getElementById('total-reservations').textContent = '127';
                document.getElementById('today-reservations').textContent = '8';
                document.getElementById('pending-reservations').textContent = '3';
                document.getElementById('confirmed-reservations').textContent = '5';
                
                addOperatorLog('Dashboard caricata con successo');
            }, 500);
        }

        function loadReservations() {
            addOperatorLog('Caricamento prenotazioni...');
            
            // Simula caricamento prenotazioni
            setTimeout(() => {
                const reservationsList = document.getElementById('reservations-list');
                reservationsList.innerHTML = '';
                
                const sampleReservations = [
                    { id: 1001, name: 'Mario Rossi', date: '2025-01-25', time: '12:30', party: 4, status: 'confirmed' },
                    { id: 1002, name: 'Giulia Bianchi', date: '2025-01-25', time: '13:00', party: 2, status: 'pending' },
                    { id: 1003, name: 'Luca Verdi', date: '2025-01-26', time: '19:30', party: 6, status: 'confirmed' },
                    { id: 1004, name: 'Anna Neri', date: '2025-01-26', time: '20:00', party: 3, status: 'cancelled' }
                ];
                
                sampleReservations.forEach(reservation => {
                    const reservationElement = document.createElement('div');
                    reservationElement.className = `reservation-item ${reservation.status}`;
                    reservationElement.innerHTML = `
                        <strong>Prenotazione #${reservation.id}</strong><br>
                        <strong>Cliente:</strong> ${reservation.name}<br>
                        <strong>Data:</strong> ${reservation.date} alle ${reservation.time}<br>
                        <strong>Persone:</strong> ${reservation.party}<br>
                        <strong>Stato:</strong> ${reservation.status}<br>
                        <div class="action-buttons">
                            <button onclick="viewReservation(${reservation.id})">Visualizza</button>
                            <button class="warning" onclick="modifyReservation(${reservation.id})">Modifica</button>
                            <button class="success" onclick="confirmReservation(${reservation.id})">Conferma</button>
                            <button class="danger" onclick="cancelReservation(${reservation.id})">Annulla</button>
                        </div>
                    `;
                    reservationsList.appendChild(reservationElement);
                });
                
                addOperatorLog(`${sampleReservations.length} prenotazioni caricate`);
            }, 800);
        }

        function addTestReservation() {
            reservationCount++;
            const newReservation = {
                id: 2000 + reservationCount,
                name: 'Test Cliente',
                date: '2025-01-27',
                time: '12:00',
                party: 2,
                status: 'pending'
            };
            
            const reservationElement = document.createElement('div');
            reservationElement.className = 'reservation-item';
            reservationElement.innerHTML = `
                <strong>Prenotazione #${newReservation.id}</strong><br>
                <strong>Cliente:</strong> ${newReservation.name}<br>
                <strong>Data:</strong> ${newReservation.date} alle ${newReservation.time}<br>
                <strong>Persone:</strong> ${newReservation.party}<br>
                <strong>Stato:</strong> ${newReservation.status}<br>
                <div class="action-buttons">
                    <button onclick="viewReservation(${newReservation.id})">Visualizza</button>
                    <button class="warning" onclick="modifyReservation(${newReservation.id})">Modifica</button>
                    <button class="success" onclick="confirmReservation(${newReservation.id})">Conferma</button>
                    <button class="danger" onclick="cancelReservation(${newReservation.id})">Annulla</button>
                </div>
            `;
            
            document.getElementById('reservations-list').appendChild(reservationElement);
            addOperatorLog(`Prenotazione test aggiunta: #${newReservation.id}`);
        }

        function viewReservation(id) {
            addOperatorLog(`Visualizzazione prenotazione #${id}`);
            alert(`Visualizzazione dettagli prenotazione #${id}`);
        }

        function modifyReservation(id) {
            addOperatorLog(`Modifica prenotazione #${id}`);
            alert(`Modifica prenotazione #${id}`);
        }

        function confirmReservation(id) {
            addOperatorLog(`Conferma prenotazione #${id}`);
            alert(`Prenotazione #${id} confermata`);
        }

        function cancelReservation(id) {
            addOperatorLog(`Annullamento prenotazione #${id}`);
            alert(`Prenotazione #${id} annullata`);
        }

        async function testOperatorFunctions() {
            updateResult('operator-test-result', false, 'Testando funzionalit√† operatore...');
            addOperatorLog('Inizio test funzionalit√† operatore');
            
            try {
                // Test 1: Accesso dashboard
                await new Promise(resolve => setTimeout(resolve, 500));
                addOperatorLog('‚úÖ Accesso dashboard');
                
                // Test 2: Caricamento prenotazioni
                await new Promise(resolve => setTimeout(resolve, 300));
                addOperatorLog('‚úÖ Caricamento prenotazioni');
                
                // Test 3: Visualizzazione dettagli
                await new Promise(resolve => setTimeout(resolve, 200));
                addOperatorLog('‚úÖ Visualizzazione dettagli');
                
                // Test 4: Filtri e ricerca
                await new Promise(resolve => setTimeout(resolve, 200));
                addOperatorLog('‚úÖ Filtri e ricerca');
                
                updateResult('operator-test-result', true, '‚úÖ Funzionalit√† operatore testate con successo');
                testResults.operatorFunctions = true;
            } catch (error) {
                updateResult('operator-test-result', false, `‚ùå Errore: ${error.message}`);
                addOperatorLog(`‚ùå Errore: ${error.message}`);
            }
            
            updateFinalResults();
        }

        async function testReservationModification() {
            updateResult('modification-test-result', false, 'Testando modifica prenotazioni...');
            addOperatorLog('Inizio test modifica prenotazioni');
            
            try {
                // Test modifica prenotazione
                await new Promise(resolve => setTimeout(resolve, 800));
                addOperatorLog('‚úÖ Modifica prenotazione');
                
                // Test salvataggio modifiche
                await new Promise(resolve => setTimeout(resolve, 300));
                addOperatorLog('‚úÖ Salvataggio modifiche');
                
                // Test notifiche
                await new Promise(resolve => setTimeout(resolve, 200));
                addOperatorLog('‚úÖ Invio notifiche');
                
                updateResult('modification-test-result', true, '‚úÖ Modifica prenotazioni testata con successo');
                testResults.reservationModification = true;
            } catch (error) {
                updateResult('modification-test-result', false, `‚ùå Errore: ${error.message}`);
                addOperatorLog(`‚ùå Errore: ${error.message}`);
            }
            
            updateFinalResults();
        }

        async function testReservationCancellation() {
            updateResult('cancellation-test-result', false, 'Testando annullamento prenotazioni...');
            addOperatorLog('Inizio test annullamento prenotazioni');
            
            try {
                // Test annullamento prenotazione
                await new Promise(resolve => setTimeout(resolve, 600));
                addOperatorLog('‚úÖ Annullamento prenotazione');
                
                // Test aggiornamento stato
                await new Promise(resolve => setTimeout(resolve, 200));
                addOperatorLog('‚úÖ Aggiornamento stato');
                
                // Test notifiche
                await new Promise(resolve => setTimeout(resolve, 200));
                addOperatorLog('‚úÖ Invio notifiche');
                
                updateResult('cancellation-test-result', true, '‚úÖ Annullamento prenotazioni testato con successo');
                testResults.reservationCancellation = true;
            } catch (error) {
                updateResult('cancellation-test-result', false, `‚ùå Errore: ${error.message}`);
                addOperatorLog(`‚ùå Errore: ${error.message}`);
            }
            
            updateFinalResults();
        }

        function updateFinalResults() {
            const total = Object.keys(testResults).length;
            const passed = Object.values(testResults).filter(Boolean).length;
            const percentage = Math.round((passed / total) * 100);
            
            const element = document.getElementById('final-results');
            element.className = percentage === 100 ? 'success' : percentage > 50 ? 'info' : 'error';
            element.textContent = `Test operatore completati: ${passed}/${total} (${percentage}%)`;
        }

        // Inizializza quando la pagina √® caricata
        document.addEventListener('DOMContentLoaded', function() {
            addOperatorLog('Sistema operatore inizializzato');
            loadDashboard();
        });
    </script>
</body>
</html>
